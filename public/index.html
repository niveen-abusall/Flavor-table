<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flavor Table🔥</title>

  <link rel="stylesheet" href="./styles.css">

  
</head>


<header>

  <a href="index.html">🏡 Home</a>
  <a href="randomRecipes.html">🥣 Random Recipes</a>
  <a href="favorites.html">⭐ Favorites</a>
  <a href="login.html">🔑 Login</a>
  <a href="register.html">📝 Register</a>


</header>
 
<main>

<h1>Find Recipes by Ingredients</h1>

<div class="search-container">
  <input type="text" id="ingredients-input" placeholder="🔎 Enter ingredients (Rice, Chicken...)">
  <button id="search-btn">Search</button>
</div>

<div id="search-results"></div>

<script>
document.getElementById("search-btn").addEventListener("click", async () => {
  const ingredients = document.getElementById("ingredients-input").value.trim();
  const resultsDiv = document.getElementById("search-results");

  if (!ingredients) {
    resultsDiv.innerHTML = "<p>Please enter at least one ingredient.</p>";
    return;
  }

  resultsDiv.innerHTML = "<p>Loading recipes...</p>";

  try {
 
    const response = await fetch(`/search?ingredients=${encodeURIComponent(ingredients)}`);
    if (!response.ok) throw new Error("Network response was not ok");

    const recipes = await response.json();

    if (recipes.length === 0) {
      resultsDiv.innerHTML = "<p>No recipes found.</p>";
      return;
    }

    resultsDiv.innerHTML = ""; // Clear old results

    recipes.forEach(recipe => {
      const card = document.createElement("div");
      card.classList.add("recipe-card");

      card.innerHTML = `
        <h2>${recipe.title}</h2>
        <img src="${recipe.image}" alt="${recipe.title}" style="max-width:200px;">
        
        <h4>🕒 Ready in: ${recipe.readyIn ?? "N/A"} mins</h4>
        
        <h4>📝 Ingredients:</h4>
        <ul>
          ${recipe.ingredients.map(ing => `<li>${ing}</li>`).join("")}
        </ul>

        <h4>📖 Instructions:</h4>
        <p>${recipe.instructions || "No instructions available"}</p>

        <button class="save-btn">⭐ Add to Favorites</button>
        <hr>
      `;

      // Save to favorites button
      card.querySelector(".save-btn").addEventListener("click", () => {
        addToFavorites({
          title: recipe.title,
          image: recipe.image,
          instructions: recipe.instructions || "No instructions available",
          ingredients: recipe.ingredients,
          readyIn: recipe.readyIn ?? 30
        });
      });

      resultsDiv.appendChild(card);
    });

  } catch (error) {
    console.error("Error fetching recipes:", error);
    resultsDiv.innerHTML = "<p>Failed to fetch recipes. Check your server or API key.</p>";
  }
});

// Add recipe to favorites (POST to backend → Postgres)
async function addToFavorites(recipe) {
  try {
    const response = await fetch(`/recipes`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(recipe)
    });

    if (response.ok) {
      alert("✅ Recipe added to favorites!");
    } else {
      const errData = await response.json();
      alert("❌ Failed to add recipe: " + (errData.error || "Unknown error"));
    }
  } catch (err) {
    console.error("Error adding to favorites:", err);
    alert("❌ Error adding recipe. Check console.");
  }
}
</script>






<body>

    <footer>
  ©️Niveen Abu-Sall - 2025
  </footer>

</body>
</html>
<script src="app.js"></script>